steps:
- id: 'clone'
  name: 'gcr.io/cloud-builders/git'
  args: ['clone', 'https://github.com/semiformal-net/openscoring-crds.git','/workspace/openscoring-crds']

- id: 'build'
  name: 'gcr.io/cloud-builders/docker'
  args: [ 'build', '-t', 'gcr.io/credit-risk-data-science/openscoring-serving:latest', '/workspace/openscoring-crds' ]

- id: 'push'
  name: 'gcr.io/cloud-builders/docker'
  args: [ 'push', 'gcr.io/credit-risk-data-science/openscoring-serving:latest']

- id: 'deploy image'
  name: 'gcr.io/cloud-builders/gcloud'
  args: ['run', 'deploy', 'openscoring-serving', '--image', 'gcr.io/credit-risk-data-science/openscoring-serving:latest', '--region', 'us-central1','--cpu','1','--ingress','all','--max-instances','2','--port','8080','--allow-unauthenticated','--min-instances','1']
